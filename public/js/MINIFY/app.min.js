function getHtml(a){return $.get(a,{async:!1},"html")}ContactView=Backbone.View.extend({tagName:"section",initialize:function(){this.render()},render:function(){var a=currentViewModel.get("template");return this.$el.append(a),$(this.el).addClass(currentViewModel.get("templatePage")),$(".currentView").append(this.el),this},close:function(){this.remove(),this.off(),this.unbind()}}),MainPageView=Backbone.View.extend({tagName:"section",initialize:function(){this.render()},render:function(){var a=currentViewModel.get("template");return this.$el.append(a),$(this.el).addClass(currentViewModel.get("templatePage")),$(".currentView").append(this.el),this},close:function(){this.remove(),this.off(),this.unbind()}}),MenuView=Backbone.View.extend({el:$(".menu"),events:{"click #menuIcon":"toggleMenu","mouseenter .unchosen":"backlightMenuOption","mouseleave .unchosen":"backlightMenuOption","click .unchosen":"choosenMenuOption","click .menuIconLink":"choosenMenuOption"},initialize:function(a){this.stayOpen=!1;var b=this;a.on("change:templatePage change:lang",function(){var c=jQuery.Event("click");c.target=$(".menuList").find("#"+a.get("templatePage"))[0],b.choosenMenuOption(c)}),this.render()},render:function(){if("en"===document.documentElement.lang)var a="templates/menu_en.html";else if("fr"===document.documentElement.lang)var a="templates/menu_fr.html";return $.get(a,{async:!1},"html").done(function(a){$(".menuList").hasClass("open")?($(".menuList-wrapper").html(a),$(".menuList").addClass("open")):$(".menuList-wrapper").html(a)}),this},toggleMenu:function(){$(".menuList").hasClass("open")?this.menuClose():this.menuOpen()},menuOpen:function(){$("#menuIcon").removeClass("unrotated"),$("#menuIcon").addClass("rotated"),$(".menuList").removeClass("close"),$(".menuList").addClass("open")},menuClose:function(){var a=this;window.setTimeout(function(){!1===a.stayOpen&&($("#menuIcon").removeClass("rotated"),$("#menuIcon").addClass("unrotated"),$(".menuList").addClass("close"),$(".menuList").removeClass("open"))},100)},backlightMenuOption:function(a){$(a.target).toggleClass("backlight")},choosenMenuOption:function(a){$(".menuList>a.choosen").removeClass("choosen"),$(a.target).addClass("choosen")},stayMenuOpen:function(a){this.stayOpen=a,!1===a&&this.menuClose()}}),WorkView=Backbone.View.extend({tagName:"section",initialize:function(){this.render()},render:function(){var a=this,b=currentViewModel.get("template");$(this.el).addClass("work"),this.$el.append('<section class="grid"></section>');var c=this.$el.find(".grid");return this.collection=new ProjectCollection,a.collection.fetch({success:function(){a.collection.each(function(a){c.append(b(a.toJSON()))},a),c.children().each(function(a,b){a%2==0?$(b).addClass("left"):$(b).addClass("right")}),c.prepend('<div  class = "grid-sizer"></div><div  class = "gutter-sizer"></div>'),$(".currentView").append(a.el),$.when(a.setGridIsotope()).done(function(b){a.listenProjectsOverview(b)})}}),this},setGridIsotope:function(){var a=$(".grid").isotope({itemSelector:".grid-item",percentPosition:!0,masonry:{columnWidth:".grid-sizer",gutter:".gutter-sizer"}});return this.addCategorySort(a),this.setInitialStyle(a),a},setInitialStyle:function(a){$(".grid-item").length%2==0?$(".grid-item:nth-last-child(-n+2)").addClass("no-margin"):$(".grid-item:last-child").addClass("no-margin"),a.isotope("layout")},addCategorySort:function(a){getHtml("templates/workCategory_"+document.documentElement.lang+".html").done(function(b){0!=$(".currentView").find(".categories").length&&$(".categories").remove(),$(".currentView").prepend(b),$(".categories").on("click touchend",".category, .wiggle",function(){$(".wiggle").hasClass("hover")&&$(".wiggle").removeClass("hover");var b=$(this).attr("data-filter");$(this).addClass("hover"),a.isotope({filter:b})})})},listenProjectsOverview:function(a){var b=this;$(".viewProjectButton").hover(function(a){$(a.currentTarget.parentNode).hasClass("open")||$(a.currentTarget.parentNode.children[0].children).removeClass("greyscale")},function(a){$(a.currentTarget.parentNode).hasClass("open")||$(a.currentTarget.parentNode.children[0].children).addClass("greyscale")}),a.on("click",".viewProjectButton",function(c){var d=c.currentTarget.parentNode;$(d).toggleClass("open"),b.fitNoMargin(),b.toggleProjectButton(c),$(d).hasClass("open")?b.showProjectElements($(d)):b.hideProjectElements($(d)),b.styleClosedProjects(a),a.isotope("layout"),b.animateGridList($(d))})},showProjectElements:function(a){var b=this.collection.models[a.index()-2].attributes,c="templates/projectsTemplates/"+b.template+"_"+currentViewModel.get("lang")+".html",d=a.find(".content"),e=this;getHtml(c).done(function(c){var f=_.template(c);if(d.append(f(b)),d.addClass(b.template+"-template"),"graphics"==e.collection.models[a.index()-2].attributes.category){if(""!=e.collection.models[a.index()-2].attributes.icons&&$(e.collection.models[a.index()-2].attributes.icons).each(function(b,c){a.find(".icons").append("<div class= icon><img id="+b+" src="+c.patch+"></img></div>").children().last().addClass("id"+c.id)}),""!=e.collection.models[a.index()-2].attributes.img){var g=0;$(e.collection.models[a.index()-2].attributes.img).each(function(b,c){if(0==g){a.find(".images").append("<div class = first></div>")}g<2&&a.find(".first").last().append("<div class= image><img id="+b+" src="+c.patch+"></img></div>"),2==g&&a.find(".images").append("<div class = second></div>"),g>=2&&a.find(".second").last().append("<div class= image><img id="+b+" src="+c.patch+"></img></div>"),4==++g&&(g=0)})}}else""!=e.collection.models[a.index()-2].attributes.img&&$(e.collection.models[a.index()-2].attributes.img).each(function(b,c){a.find(".images").append("<div class= image><img id="+b+" src="+c.patch+"></img></div>"),a.find(".images").children().last().addClass("id"+c.id)});""!=e.collection.models[a.index()-2].attributes.video&&$(e.collection.models[a.index()-2].attributes.video).each(function(b,c){a.find(".videos").append("<div class=video>"+c.patch+"</div>")})}),a.find(".content")[0].scrollTop=0},hideProjectElements:function(a){a.find(".content").children().not(":first").remove(),a.find(".content").removeClass().addClass("content")},animateGridList:function(a){a.hasClass("open")&&$("html, body").animate({scrollTop:a.offset().top},3e3),$(".grid").one("transitionend",function(){$("html, body").stop();var b=a.offset().top-$(".menu").outerHeight()-.08*$(".currentView").height();$("html, body").animate({scrollTop:b},400)})},toggleProjectButton:function(a){$(a.currentTarget).hasClass("in-open")||($(a.currentTarget).addClass("in-open"),"en"===document.documentElement.lang?a.currentTarget.innerHTML="<p> CLOSE </p>":"fr"===document.documentElement.lang&&(a.currentTarget.innerHTML="<p> FERMER </p>")),a.currentTarget.parentNode.className.includes("open")||("en"===document.documentElement.lang?a.currentTarget.innerHTML="<p> VIEW </p>":"fr"===document.documentElement.lang&&(a.currentTarget.innerHTML="<p> VOIR </p>"),$(a.currentTarget).removeClass("in-open"))},fitNoMargin:function(){$(".grid-item").length%2==0?($(".open").last().nextAll().length%2!=0&&($(".grid-item").removeClass("no-margin"),$(".grid-item:last-child").addClass("no-margin")),$(".grid-item:nth-last-child(1)").hasClass("open")||$(".grid-item:nth-last-child(2)").hasClass("open")||$(".grid-item").hasClass("open")||($(".grid-item").removeClass("no-margin"),$(".grid-item:nth-last-child(-n+2)").addClass("no-margin")),0==$(".open").last().nextAll().length&&$(".grid-item").hasClass("open")&&($(".grid-item").removeClass("no-margin"),$(".grid-item:last-child").addClass("no-margin"))):($(".open").last().nextAll().length%2==0?($(".grid-item").removeClass("no-margin"),$(".grid-item:nth-last-child(-n+2)").addClass("no-margin")):($(".grid-item").removeClass("no-margin"),$(".grid-item:last-child").addClass("no-margin")),0==$(".open").last().nextAll().length&&($(".grid-item").removeClass("no-margin"),$(".grid-item:last-child").addClass("no-margin")),$(".grid-item:nth-last-child(1)").hasClass("open")||$(".grid-item:nth-last-child(2)").hasClass("open")||$(".grid-item").hasClass("open")||($(".grid-item").removeClass("no-margin"),$(".grid-item:last-child").addClass("no-margin")))},styleClosedProjects:function(a){$(".grid").one("transitionend",function(){a.children().each(function(a,b){b.className.includes("grid-item")&&!b.className.includes("open")&&(b.getBoundingClientRect().left<.5*$(".grid").width()&&$(b).hasClass("right")?$(b).toggleClass("right left"):b.getBoundingClientRect().left>.5*$(".grid").width()&&$(b).hasClass("left")&&$(b).toggleClass("left right"))})})},close:function(){$(".categories").remove(),this.remove(),this.off(),this.unbind()}}),AboutView=Backbone.View.extend({tagName:"section",initialize:function(){this.render()},render:function(){var a=currentViewModel.get("template");return this.$el.append(a),$(this.el).addClass(currentViewModel.get("templatePage")),$(".currentView").append(this.el),this},close:function(){this.remove(),this.off(),this.unbind()}}),MenuRouter=Backbone.Router.extend({routes:{"":"callTemplate","*work":"callTemplate","*about":"callTemplate","*contact":"callTemplate"},initialize:function(){},callTemplate:function(a){null===a&&(a="mainPage"),currentViewModel.set({templatePage:a})}}),CurrentViewModel=Backbone.Model.extend({defaults:{templatePage:"",template:"",lang:document.documentElement.lang},getTemplate:function(){var a="templates/"+this.get("templatePage")+"_"+this.get("lang")+".html";return $.get(a,{async:!1},"html")}}),ProjectModel=Backbone.Model.extend({defaults:{id:"",title:"",icon:"",description_en:"",description_fr:"",img:"",video:"",category:"",template:""}}),ProjectCollection=Backbone.Collection.extend({url:"projects\\projects.json"});function viewController(){currentViewModel.getTemplate().done(function(a){currentViewModel.set({template:_.template(a)}),switchPage(currentViewModel.get("templatePage"))})}function switchPage(a){switch(this.currentView&&(pageList.indexOf(a)>pageList.indexOf(this.currentView.el.className)?(this.translate="translateRight",this.slide="slideLeft"):(this.translate="transalateLeft",this.slide="slideRight")),a){case"mainPage":this.tmpCurrentView=new MainPageView;break;case"work":this.tmpCurrentView=new WorkView;break;case"about":this.tmpCurrentView=new AboutView;break;case"contact":this.tmpCurrentView=new ContactView}var b=this;this.translate?($(this.tmpCurrentView.el).addClass(this.translate),$(this.tmpCurrentView.el).addClass(this.slide),$(this.tmpCurrentView.el).one("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",function(){b.currentView.close(),$(b.tmpCurrentView.el).removeClass(b.translate).removeClass(b.slide),b.currentView=b.tmpCurrentView,$(this).off("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd")})):b.currentView=b.tmpCurrentView}var pageList=["mainPage","work","about","contact"],currentViewModel=new CurrentViewModel,menuView=new MenuView(currentViewModel);currentViewModel.on("change:templatePage change:lang",function(){viewController()}),$(".lang").click(function(a){currentViewModel.set({lang:a.target.id}),document.documentElement.lang=currentViewModel.get("lang"),menuView.render()}),$(".currentView").on("swipeleft",function(a){var b=pageList.indexOf(currentViewModel.get("templatePage"));b<3&&(window.location="#"+pageList[b+1])}),$(".currentView").on("swiperight",function(a){var b=pageList.indexOf(currentViewModel.get("templatePage"));b>0&&(window.location="#"+pageList[b-1])});var menuRouter=new MenuRouter;Backbone.history.start();